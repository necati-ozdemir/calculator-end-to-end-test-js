pipeline {
  agent any

  options {
    buildDiscarder(logRotator(numToKeepStr: '3'))
  }


  stages {
    stage('Checkout') {
      steps {
        checkout scm
      }
    }
    stage('Get dependencies') {
      steps {
        withNPM(npmrcConfig:'my-custom-npmrc') {
            sh 'npm install'
        }
      }
    }
    stage('Execute') {
      steps {
        withNPM(npmrcConfig:'my-custom-npmrc') {
            sh 'npm run upAndOpen'
            sh 'npm run compose-down'
        }
      }
    }
  }

  post {
    always {
      junit keepLongStdio: true, testResults: 'test-results/*.xml', allowEmptyResults: true
      archiveArtifacts artifacts: 'cypress/videos/**/*.mp4', onlyIfSuccessful: false
    }
  }
}
